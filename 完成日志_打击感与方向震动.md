# 完成日志：打击感与方向震动 & 喷子全弹命中停顿 & 开枪屏幕缩放

## 项目结构
- 打击感脚本 `HitFeedback.cs` 位于 `Assets/Scripts/` 文件夹。
- 修改 `GunShoot.cs`，为发射的子弹增加批量标识和总数量信息，并增加开枪屏幕缩放功能，修复了 `ResetZoom` 调用参数问题。
- 修改 `Bullet.cs`，使其携带批量信息并在击中敌人时传递。
- 修改 `Enemy.cs`，增加批量击中计数和全弹命中判断逻辑，并增加延迟触发时间停顿的协程以避免击退被吞掉。
- `HitFeedback.cs` 脚本可挂载在场景任意物体（如 CameraManager）。

## 系统实现逻辑
1. `HitFeedback` 采用单例模式，其他脚本可通过 `HitFeedback.Instance` 方便调用。
2. 支持多种打击感效果：
   - 普通摄像机震动（CameraShake）
   - 方向震动（DirectionalShake）：主方向正弦震动+小幅度垂直抖动，方向和幅度可配置
   - 摄像机缩放（CameraZoom/ResetZoom）
   - 游戏慢动作（SlowMotion）
3. **喷子全弹命中强化反馈**：
   - `GunShoot` 为每次射击生成唯一的批量ID，并知道本批次发射的总子弹数。
   - 子弹 (`Bullet`) 实例化时被赋予其所属的批量ID和总数量，并额外携带计算好的击退方向和力量信息。
   - 子弹击中敌人时，调用敌人 (`Enemy`) 的方法，传递批量ID、总数量以及击退方向和力量。
   - 敌人维护一个字典，记录每个批量ID的子弹击中自身的次数。
   - 当同一批量ID的子弹击中次数达到该批次的总子弹数量时，判断为全弹命中。
   - **全弹命中时，会立即通过 `HitFeedback.Instance.SlowMotion()` 触发游戏时间变慢效果，并通过 `HitFeedback.Instance.FocusOnTargetMidpoint()` 启动摄像机平滑聚焦到玩家与该敌人之间的中点。同时，启动一个短暂的协程 (`ApplyFullShotgunKnockback`)，等待一小段设定的延迟时间（在慢动作期间），临时提高敌人的击退倍率，然后施加存储的击退力量，恢复原倍率并启动正常的击退状态。这个延迟和增强的击退确保了击退效果在慢动作和摄像机聚焦时清晰地展现，避免了物理效果被吞噬的问题。**
4. **开枪屏幕缩放**：
   - 在玩家开枪时 (`GunShoot`)，通过协程调用 `HitFeedback.Instance.CameraZoom()` 将屏幕平滑拉近到设定的目标Orthographic Size，并设置缩放持续时间。
   - 等待设定的缩放持续时间后，调用 `HitFeedback.Instance.ResetZoom()` 将屏幕恢复到原始大小（恢复速度由 `HitFeedback.cs` 内部控制）。
   - 使用标志位避免在缩放过程中重复触发。
   - `shootZoomResetDuration` 参数现在用于控制屏幕恢复后，再次允许触发缩放效果的等待时间。
5. 所有参数分组并有中文注释，Inspector面板可调，调用时也可传参覆盖。
6. 方向震动可用于近战、爆炸、击退等需要方向感的打击反馈。

## 数据结构
- `HitFeedback` 公开变量：
  - 震动、方向震动、缩放、慢动作相关参数
  - 新增摄像机聚焦中点相关变量：`isFocusingOnMidpoint` (bool), `midpointFocusTarget` (Transform), `focusCoroutine` (Coroutine), `originalFollowPos` (Vector3)。
- `HitFeedback` 主要方法：
  - `CameraShake()` 普通震动
  - `DirectionalShake()` 方向震动
  - `CameraZoom()/ResetZoom()` 缩放与恢复
  - `SlowMotion()` 慢动作
- `GunShoot` 新增 `shootBatchCounter` (静态int)，新增打击感设置分组，包含 `shootZoomSize` (float), `shootZoomDuration` (float), `shootZoomResetDuration` (float) - 用于控制下次缩放允许触发的等待时间，以及 `isZooming` (bool) 标志位。
- `Bullet` 新增 `shootBatchID` (int) 和 `totalBulletsInBatch` (int)，新增公共方法 `SetShootBatchInfo()`，并在击中敌人时传递计算好的击退方向和力量给敌人。
- `Enemy` 新增 `bulletBatchHits` (Dictionary<int, int>)，新增公共方法 `OnBulletHitBatch()` (现在接收击退方向和力量参数)，新增私有协程 `ApplyFullShotgunKnockback()`。新增满喷打击反馈配置分组，包含 `fullShotgunSlowdownDuration` (float), `fullShotgunSlowdownFactor` (float), `fullShotgunKnockbackDelay` (float), `fullShotgunTempKnockbackMultiplier` (float)。新增用于存储延迟击退信息的 `pendingKnockbackDir` (Vector2) 和 `pendingKnockbackPower` (float)。移除了 `DelayedSlowMotion` 协程。

## 目录
- 项目结构与节点说明：本日志
- 敌人生成机制：完成日志_敌人生成机制.md
- 敌人寻路与流场AI：完成日志_敌人寻路与流场AI.md
- 打击感与方向震动 & 喷子全弹命中停顿 & 开枪屏幕缩放实现细节：本日志已包含
- 其他系统日志（根据需要列出）

## 用户需要操作的重点
1. 确保场景中存在一个挂载了 `HitFeedback.cs` 脚本的 GameObject，且主摄像机为 Camera.main，并已设置 `followTarget` 为玩家。
2. 确保挂载了 `GunShoot.cs` 脚本的 GameObject 在 Inspector 面板中配置了打击感设置下的缩放参数。
3. 确保敌人 (`Enemy`) 脚本在 Inspector 面板中配置了新增的"满喷打击反馈"分组下的参数，特别是 `Full Shotgun Slowdown Duration`, `Full Shotgun Slowdown Factor`, `Full Shotgun Knockback Delay`, `Full Shotgun Temp Knockback Multiplier`。
4. 在敌人 (`Enemy`) 脚本的 Inspector 面板中，找到新增的"调试设置"分组，设置 `Full Shotgun Debug Color` 来指定满喷命中时敌人的显示颜色。
5. `GunShoot` 和 `Bullet` 脚本会自动配合工作。
6. 敌人 (`Enemy`) 脚本会自动接收并处理批量击中信息，并在满喷时触发延迟增强击退和摄像机聚焦，同时提供调试反馈。
7. 可在 `HitFeedback` 的 Inspector 面板中调整满喷摄像机聚焦相关的过渡时间和保持时间（目前硬编码在 `DoFocusOnMidpoint` 协程中）。

现在，当玩家使用喷子全弹命中同一敌人时，游戏会进入短暂慢动作，摄像机会聚焦到玩家和敌人的中点，被命中的敌人会短暂变色，随后该敌人会受到一个增强的击退效果，控制台会输出详细的击退数据，帮助你调试功能。当敌人结束击退状态时，控制台也会有相应输出。

## 示例用法
```csharp
// 普通震动
HitFeedback.Instance.CameraShake();
// 方向震动（向上，主幅度0.5，左右幅度0.1，持续0.2秒）
HitFeedback.Instance.DirectionalShake(Vector2.up, 0.5f, 0.1f, 0.2f, Vector2.right);
// 缩放
HitFeedback.Instance.CameraZoom(3.5f, 8f);
// 恢复缩放
HitFeedback.Instance.ResetZoom();
// 慢动作
HitFeedback.Instance.SlowMotion(0.3f, 0.15f);
// 聚焦中点 (从敌人脚本调用，传递自身transform)
// HitFeedback.Instance?.FocusOnTargetMidpoint(transform);
``` 