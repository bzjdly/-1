# 完成日志：打击感与方向震动 & 喷子全弹命中停顿 & 开枪屏幕缩放

## 项目结构
- 打击感脚本 `HitFeedback.cs` 位于 `Assets/Scripts/` 文件夹。
- 修改 `GunShoot.cs`，为发射的子弹增加批量标识和总数量信息，并增加开枪屏幕缩放功能，修复了 `ResetZoom` 调用参数问题。
- 修改 `Bullet.cs`，使其携带批量信息并在击中敌人时传递。
- 修改 `Enemy.cs`，增加批量击中计数和全弹命中判断逻辑。
- `HitFeedback.cs` 脚本可挂载在场景任意物体（如 CameraManager）。

## 系统实现逻辑
1. `HitFeedback` 采用单例模式，其他脚本可通过 `HitFeedback.Instance` 方便调用。
2. 支持多种打击感效果：
   - 普通摄像机震动（CameraShake）
   - 方向震动（DirectionalShake）：主方向正弦震动+小幅度垂直抖动，方向和幅度可配置
   - 摄像机缩放（CameraZoom/ResetZoom）
   - 游戏慢动作（SlowMotion）
3. **喷子全弹命中停顿**：
   - `GunShoot` 为每次射击生成唯一的批量ID，并知道本批次发射的总子弹数。
   - 子弹 (`Bullet`) 实例化时被赋予其所属的批量ID和总数量。
   - 子弹击中敌人时，调用敌人 (`Enemy`) 的方法，传递批量ID和总数量。
   - 敌人维护一个字典，记录每个批量ID的子弹击中自身的次数。
   - 当同一批量ID的子弹击中次数达到该批次的总子弹数量时，判断为全弹命中。
   - 全弹命中时，通过 `HitFeedback.Instance.SlowMotion()` 触发游戏时间变慢效果，增强打击感。
4. **开枪屏幕缩放**：
   - 在玩家开枪时 (`GunShoot`)，通过协程调用 `HitFeedback.Instance.CameraZoom()` 将屏幕平滑拉近到设定的目标Orthographic Size，并设置缩放持续时间。
   - 等待设定的缩放持续时间后，调用 `HitFeedback.Instance.ResetZoom()` 将屏幕恢复到原始大小（恢复速度由 `HitFeedback.cs` 内部控制）。
   - 使用标志位避免在缩放过程中重复触发。
   - `shootZoomResetDuration` 参数现在用于控制屏幕恢复后，再次允许触发缩放效果的等待时间。
5. 所有参数分组并有中文注释，Inspector面板可调，调用时也可传参覆盖。
6. 方向震动可用于近战、爆炸、击退等需要方向感的打击反馈。

## 数据结构
- `HitFeedback` 公开变量：
  - 震动、方向震动、缩放、慢动作相关参数
- `HitFeedback` 主要方法：
  - `CameraShake()` 普通震动
  - `DirectionalShake()` 方向震动
  - `CameraZoom()/ResetZoom()` 缩放与恢复
  - `SlowMotion()` 慢动作
- `GunShoot` 新增 `shootBatchCounter` (静态int)，新增打击感设置分组，包含 `shootZoomSize` (float), `shootZoomDuration` (float), `shootZoomResetDuration` (float) - 用于控制下次缩放允许触发的等待时间，以及 `isZooming` (bool) 标志位。
- `Bullet` 新增 `shootBatchID` (int) 和 `totalBulletsInBatch` (int)，新增公共方法 `SetShootBatchInfo()`。
- `Enemy` 新增 `bulletBatchHits` (Dictionary<int, int>)，新增公共方法 `OnBulletHitBatch()`.

## 目录
- 项目结构与节点说明：本日志
- 敌人生成机制：完成日志_敌人生成机制.md
- 敌人寻路与流场AI：完成日志_敌人寻路与流场AI.md
- 打击感与方向震动 & 喷子全弹命中停顿 & 开枪屏幕缩放实现细节：本日志已包含
- 其他系统日志（根据需要列出）

## 用户需要操作的重点
1. 确保场景中存在一个挂载了 `HitFeedback.cs` 脚本的 GameObject，且主摄像机为 Camera.main。
2. 确保挂载了 `GunShoot.cs` 脚本的 GameObject 在 Inspector 面板中配置了打击感设置下的缩放参数（`Shoot Zoom Size`, `Shoot Zoom Duration`, `Shoot Zoom Reset Duration`）。注意 `Shoot Zoom Reset Duration` 现在控制的是缩放效果结束后，再次允许触发缩放效果前的等待时间。
3. `GunShoot` 和 `Bullet` 脚本会自动配合工作。
4. 敌人 (`Enemy`) 脚本会自动接收并处理批量击中信息。
5. 可在 `HitFeedback` 的 Inspector 面板中调整慢动作（SlowMotion）的参数来优化效果，以及默认的摄像机恢复速度。

现在，当玩家使用喷子射击时，屏幕会短暂拉近再恢复，全弹命中同一敌人时会触发时间变慢。

## 示例用法
```csharp
// 普通震动
HitFeedback.Instance.CameraShake();
// 方向震动（向上，主幅度0.5，左右幅度0.1，持续0.2秒）
HitFeedback.Instance.DirectionalShake(Vector2.up, 0.5f, 0.1f, 0.2f, Vector2.right);
// 缩放
HitFeedback.Instance.CameraZoom(3.5f, 8f);
// 恢复缩放
HitFeedback.Instance.ResetZoom();
// 慢动作
HitFeedback.Instance.SlowMotion(0.3f, 0.15f);
``` 